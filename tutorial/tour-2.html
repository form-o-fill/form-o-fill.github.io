---
layout: tutorial
---
<h1>Tour 2: Using rules</h1>

<textarea class="rules" id="rules1">
  {
  "workflows": [
    {
      "id": 1,
      "name": "blau.de - Bestellen",
      "steps": [
        "Bestellen - Tarif",
        "Bestellen - Handynummer",
        "Bestellen - Kundendaten",
        "Bestellen - Zahlungsdaten",
        "Bestellen - Bestätigen"
      ]
    },
    {
      "id": 2,
      "name": "CSC Login  &  Kontakt öffnen",
      "steps": [
        "CSC - Login",
        "Dashboard - CSC"
      ]
    }
  ],
  "rules": {
    "tabSettings": [
      {
        "id": "1",
        "name": "Freischalten"
      },
      {
        "id": "2",
        "name": "Bestellen"
      },
      {
        "id": "3",
        "name": "SelfCare"
      },
      {
        "id": "4",
        "name": "Mobile"
      },
      {
        "id": "5",
        "name": "LIBS"
      },
      {
        "id": "6",
        "name": "SHARED"
      },
      {
        "id": "7",
        "name": "CSC"
      },
      {
        "id": "8",
        "name": "Merchant"
      },
      {
        "id": "9",
        "name": "ESIM"
      }
    ],
    "rules": [
      {
        "code": "var rules = [{\n  \"url\": /\\/freischalten\\/?$/,\n  \"name\": \"Freischalten - Login\",\n  \"before\": function(resolve, context) {\n    Libs.env(context).then(function(env) {\n      jQuery.getJSON(\"http://bender.\" + env.host + \".hh.blau.de/bender/smiley/msisdn/new?mandant=\" + env.mandant).done(resolve);\n    });\n  },\n  \"fields\": [{\n    \"selector\": \"input[name='cashcarry_login[fullnumber]']\",\n    \"value\": function(_, $data) {\n      return $data.fullnumber;\n    }\n  }, {\n    \"selector\": \"input[name='cashcarry_login[credential]']\",\n    \"value\": function(_, $data) {\n      return $data.pin;\n    }\n  }, {\n    \"selector\": \".new_cashcarry_login input[type=submit]\",\n    \"value\": Libs.h.click\n  }]\n}, {\n  \"url\": /freischalten\\/kundendaten\\/?$/,\n  \"name\": \"Freischalten - Kundendaten\",\n  \"before\": function(resolve, context) {\n    Libs.env(context).then(function(env) {\n      jQuery.getJSON(\"http://bender.\" + env.host + \".hh.blau.de/bender/chief/direct_debit/valid/new\").done(resolve);\n    });\n  },\n  \"fields\": [{\n    \"selector\": \"input[name='private[first_name]']\",\n    \"value\": function(_, $data) {\n      return $data.first_name;\n    }\n  }, {\n    \"selector\": \"input[name='private[last_name]']\",\n    \"value\": function(_, $data) {\n      return $data.last_name;\n    }\n  }, {\n    \"selector\": \"input[name='private[date_of_birth]']\",\n    \"value\": function(_, $data) {\n      return $data.date_of_birth;\n    }\n  }, {\n    \"selector\": \"input[name='private[billing_address_attributes][street]']\",\n    \"value\": function($element, $data) {\n      return $data.street;\n    }\n  }, {\n    \"selector\": \"input[name='private[billing_address_attributes][house_number]']\",\n    \"value\": function(_, $data) {\n      return $data.house_number;\n    }\n  }, {\n    \"selector\": \"input[name='private[billing_address_attributes][zip]']\",\n    \"value\": function(_, $data) {\n      return $data.zip_code;\n    }\n  }, {\n    \"selector\": \"input[name='private[billing_address_attributes][city]']\",\n    \"value\": function(_, $data) {\n      return $data.city;\n    }\n  }, {\n    \"selector\": \"input[name='private[billing_address_attributes][addendum]']\",\n    \"value\": \"\"\n  }, {\n    \"selector\": \"input[name='private[email]']\",\n    \"value\": function(_, $data) {\n      return \"dev-\" + $data.house_number + \"@blau.de\";\n    }\n  }, {\n    \"selector\": \"input[name='private[phone]']\",\n    \"value\": function(_, $data) {\n      return '0401111' + $data.house_number;\n    }\n  }, {\n    \"selector\": \"input[name='private[recommender]']\",\n    \"value\": \"\"\n  }, {\n    \"selector\": \"input[name='private[customer_type]']\",\n    \"value\": \"private\"\n  }, {\n    \"selector\": \"select[name='private[salutation]']\",\n    \"value\": \"Mr\"\n  }, {\n    \"selector\": \"select[name='private[title]']\",\n    \"value\": \"None\"\n  }, {\n    \"selector\": \"select[name='private[evn]']\",\n    \"value\": \"full\"\n  }, {\n    \"selector\": \"input[name='private[accepted_dne]'][type=checkbox]\",\n    \"value\": \"1\"\n  }]\n}, {\n  \"url\": /\\/nummer\\/?$/,\n  \"name\": \"Freischalten - MNP\",\n  \"fields\": [{\n    \"selector\": \"input[name='private[first_name]']\",\n    \"value\": function() {\n      $('.nav.box_mnp.js-toggable:not(.open) h4').click();\n      return \"Klaus\";\n    }\n  }, {\n    \"selector\": \"input[name='private[last_name]']\",\n    \"value\": \"Meier\"\n  }, {\n    \"selector\": \"input[name='private[date_of_birth]']\",\n    \"value\": \"05.02.1970\"\n  }, {\n    \"selector\": \"input[name='private[msisdn]']\",\n    \"value\": function($e, $d) {\n      return '017' + Libs.chance.natural({\n        min: 0,\n        max: 9\n      }) + '-' + Libs.chance.natural({\n        min: 1000000,\n        max: 9999999\n      });\n    }\n  }, {\n    \"selector\": \"input[name='private[customer_type]']\",\n    \"value\": \"private\"\n  }, {\n    \"selector\": \"input[name='private[contract_type]']\",\n    \"value\": \"prepaid\"\n  }, {\n    \"selector\": \"input[name='private[mnp_portin_before_cancellation_date]']\",\n    \"value\": \"ASAP\"\n  }, {\n    \"selector\": \"select[name='private[brand]']\",\n    \"value\": \"BRFONI\"\n  }]\n}, {\n  \"url\": /\\/tarifoptimierung\\/?/,\n  \"name\": \"Freischalten - Tarifoptimierung\",\n  \"fields\": [{\n    \"selector\": \"input[name='cashcarry_tariff_optimization[account_number]']\",\n    \"value\": \"DE68300700100250800000\"\n  }, {\n    \"selector\": \"input[name='cashcarry_tariff_optimization[bank_code]']\",\n    \"value\": \"DEUTDEDDXXX\"\n  }, {\n    \"selector\": \"input[name='cashcarry_tariff_optimization[topup_type]']\",\n    \"value\": function($element, _) {\n      $element.click();\n      return \"Watermark\";\n    }\n  }, {\n    \"selector\": \"input[name='tariff_option[smart_option200200200]']\",\n    \"value\": true\n  }, {\n    \"selector\": \"input[name='cashcarry_tariff_optimization[debit_allowed]'][type=checkbox]\",\n    \"value\": \"1\"\n  }, {\n    \"selector\": \"select[name='cashcarry_tariff_optimization[watermark]']\",\n    \"value\": \"15\"\n  }, {\n    \"selector\": \"select[name='cashcarry_tariff_optimization[amount]']\",\n    \"value\": \"10\"\n  }]\n}\n];",
        "tabId": 1
      },
      {
        "code": "var rules = [{\n  \"url\": /bestellen\\/tarif/,\n  \"name\": \"Bestellen - Tarif\",\n  \"fields\": [{\n    \"selector\": \"form.tariff-options input.right\",\n    \"value\": function(e) {\n      e.click();\n    }\n  }]\n}, {\n  \"url\": /bestellen\\/handynummer/,\n  \"name\": \"Bestellen - Handynummer\",\n  \"fields\": [{\n    \"selector\": \"form.number button.right\",\n    \"value\": function(e) {\n      e.click();\n    }\n  }]\n}, {\n  \"url\": /kundendaten/,\n  \"name\": \"Bestellen - Kundendaten\",\n  \"fields\": [{\n    \"selector\": \"input[name='private[first_name]']\",\n    \"value\": \"Karl\"\n  }, {\n    \"selector\": \"input[name='private[last_name]']\",\n    \"value\": \"Schmidt\"\n  }, {\n    \"selector\": \"input[name='private[date_of_birth]']\",\n    \"value\": \"01.01.1970\"\n  }, {\n    \"selector\": \"input[name='private[billing_address_attributes][zip]']\",\n    \"value\": \"22303\"\n  }, {\n    \"selector\": \"input[name='private[billing_address_attributes][city]']\",\n    \"value\": \"Grimmelshausen\"\n  }, {\n    \"selector\": \"input[name='private[billing_address_attributes][street]']\",\n    \"value\": \"Ordingweg\"\n  }, {\n    \"selector\": \"input[name='private[billing_address_attributes][house_number]']\",\n    \"value\": \"1000\"\n  }, {\n    \"selector\": \"input[name='private[email]']\",\n    \"value\": \"moosbacher@example.com\"\n  }, {\n    \"selector\": \"input[name='private[phone]']\",\n    \"value\": \"04034724192\"\n  }, {\n    \"selector\": \"input[name='private[accepted_dne]']\",\n    \"value\": true\n  }, {\n    \"selector\": \"input[name='private[customer_type]']\",\n    \"value\": \"private\"\n  }, {\n    \"selector\": \"select[name='private[salutation]']\",\n    \"value\": \"Mr\"\n  }, {\n    \"selector\": \"select[name='private[title]']\",\n    \"value\": \"Dr\"\n  }, {\n    \"selector\": \"select[name='private[evn]']\",\n    \"value\": \"full\"\n  }, {\n    \"selector\": \"#private_submit\",\n    \"value\": function(e) {\n      e.click();\n    }\n  }]\n}, {\n  \"url\": /zahlungsdaten/,\n  \"name\": \"Bestellen - Zahlungsdaten\",\n  \"before\": function(resolve, context) {\n    Libs.env(context).then(function(env) {\n      jQuery.getJSON(\"http://bender.\" + env.host + \".hh.blau.de/bender/chief/direct_debit/valid/new?customer_id=&hardware_option=true\").done(resolve);\n    });\n  },\n  \"fields\": [{\n    selector: \"section.payment_advance h4\",\n    value: function(e) {\n      e.click();\n    }\n  }, {\n    \"selector\": \"#topup_and_payment_account_number\",\n    \"value\": function(e, data) {\n      return data.iban;\n    }\n  }, {\n    \"selector\": \"#topup_and_payment_debit_allowed\",\n    \"value\": true\n  }, {\n    \"selector\": \"section.payment_direct_debit input[type=submit]\",\n    \"value\": function(e) {\n      e.click();\n    }\n  }]\n}, {\n  \"url\": /bestellen\\/bestaetigen/,\n  \"name\": \"Bestellen - Bestätigen\",\n  \"fields\": [{\n    \"selector\": \"#confirm_terms_and_conditions\",\n    \"value\": function(e) {\n      e.click();\n    }\n  }, {\n    \"selector\": \"#confirmation_button\",\n    \"value\": function(e) {\n      e.click();\n    }\n  }]\n}\n];",
        "tabId": 2
      },
      {
        "code": "var rules = [{\n  \"url\": /\\/konto\\/a(n|b)melden/,\n  \"name\": \"Anmelden (BLAU_UNION + Lastschrift + Optionen + Invoices)\",\n  \"before\": function(resolve, context) {\n    var tariffOptionsToBook = [\"ALLNET_FLAT_PREPAID:Provided\", \"COST_GUARD:Provided\", \"DATA_100MB:Provided\"];\n    var amount = 100.00;\n    Libs.env(context).then(function(env) {\n      jQuery.getJSON(\"http://bender.\" + env.host + \".hh.blau.de/bender/smiley/customer/new?mandant=\" + env.mandant + \"&base_tariff=BLAU_UNION&tariff_change_new_base_tariff=&tariff_change_status=&payment_type=DirectDebit&with_sepa_data=true&topup_type=Watermark&amount=\" + amount + \"&tariff_option=&tariff_options=\" + tariffOptionsToBook.join(\",\") + \"&tariff_option_status=&hardware_upgrade=&salespartner_id=&activation_date=2010-11-01+11%3A34%3A23&first_call=2010-11-01+11%3A34%3A23&distribution_type=Online&name=&order_date=2010-11-01+11%3A34%3A23&email=&contract_sign_stamp=2010-10-13+12%3A00%3A00&contract_start_date=2010-10-13+12%3A00%3A00&customer_consents_md_ids=41601%2C41602%2C41606%2C41607%2C41608%2C41609&deactivation_time=&date_of_birth=1986-12-22+00%3A00%3A00\").done(function(data) {\n        // Create XDRs (For EVN)\n        jQuery.getJSON(\"http://bender.\" + env.host + \".hh.blau.de/bender/smiley/xdr/new?msisdn=\" + data.msisdn + \"&date=2015-04-01+10%3A17%3A14\");\n        // Create 10 random invoices\n        var productIds = [\"AcquisitionFeeTopup\", \"AutotopupMonthly\", \"AutotopupWatermark\", \"Cashvoucher\", \"Credit\", \"CrmTopup\", \"Discount\", \"FundsDecayPrevention\", \"GoodwillCredit\", \"InvitationBonusTopup\", \"Kundenueberzahlung\", \"Mnp\", \"NormaCommunityDiscount\", \"QualifiedReturnOtherCharge\", \"QualifiedReturnStarterCredit\", \"QualifiedReturnStarterpack\", \"QualifiedReturnTopup\", \"ReturnDebitFee\", \"ServiceFee\", \"ServicesOverpayment\", \"ShadowBonus\", \"ShadowTopup\", \"Shipping\", \"StarterCredit\", \"Starterpack\", \"Topup\"];\n        for (var j, x, i = productIds.length; i; j = Math.floor(Math.random() * i), x = productIds[--i], productIds[i] = productIds[j], productIds[j] = x);\n        for (i = 0; i < 10; i++) {\n          var productId = productIds[i];\n          jQuery.getJSON(\"http://bender.\" + env.host + \".hh.blau.de/bender/smiley/invoice/newForCustomer?status=Finished&product_id=\" + productId + \"&customer_id=\" + data.customer_id).done();\n        }\n        resolve(data);\n      });\n    });\n  },\n  \"fields\": [{\n    \"import\": \"Konto Login (SHARED)\"\n  }]\n}, {\n  \"url\": /\\/konto\\/a(n|b)melden/,\n  \"name\": \"Anmelden (BLAU_UNION + Kreditkarte)\",\n  \"before\": function(resolve, context) {\n    Libs.env(context).then(function(env) {\n      jQuery.getJSON(\"http://bender.\" + env.host + \".hh.blau.de/bender/smiley/customer/new?mandant=\" + env.mandant + \"&base_tariff=BLAU_UNION&tariff_change_new_base_tariff=&tariff_change_status=&payment_type=CreditCard&with_sepa_data=true&topup_type=None&shipped_simcard=true&amount=100.00&tariff_option=&tariff_option_status=Provided&hardware_upgrade=&salespartner_id=&activation_date=2010-11-01+11%3A34%3A23&first_call=2010-11-01+11%3A34%3A23&distribution_type=Online&name=&order_date=2010-11-01+11%3A34%3A23&email=&contract_sign_stamp=2010-10-13+12%3A00%3A00&contract_start_date=2010-10-13+12%3A00%3A00&customer_consents_md_ids=41601%2C41602%2C41606%2C41607%2C41608%2C41609\").done(resolve);\n    });\n  },\n  \"fields\": [{\n    \"import\": \"Konto Login (SHARED)\"\n  }]\n}, {\n  \"url\": /\\/konto\\/a(n|b)melden/,\n  \"name\": \"Anmelden (BLAU_LAUFZEIT; +EVN, BASETARIFF_UPGRADE_1GB)\",\n  \"before\": function(resolve, context) {\n    Libs.env(context).then(function(env) {\n      // Create XDRs (For EVN)\n      jQuery.getJSON(\"http://bender.\" + env.host + \".hh.blau.de/bender/smiley/customer/new?mandant=BlauLaufzeit&base_tariff=BLAU_ALLNET_FLAT&payment_type=DirectDebit&with_sepa_data=true&topup_type=None&shipped_simcard=true&live_amount=100.00&tariff_option=BASETARIFF_UPGRADE_1GB&tariff_option_status=Provided&hardware_upgrade=&salespartner_id=&activation_date=2010-11-01+11%3A34%3A23&first_call=2010-11-01+11%3A34%3A23&distribution_type=Online&name=&order_date=2010-11-01+11%3A34%3A23&email=&contract_sign_stamp=2010-10-13+12%3A00%3A00&contract_start_date=2010-10-13+12%3A00%3A00&customer_consents_md_ids=41601%2C41602%2C41606%2C41607%2C41608%2C41609\").done(function(data) {\n        jQuery.getJSON(\"http://bender.\" + env.host + \".hh.blau.de/bender/smiley/xdr/new?msisdn=\" + data.msisdn + \"&date=2015-03-01+10%3A17%3A14\");\n        jQuery.getJSON(\"http://bender.\" + env.host + \".hh.blau.de/bender/smiley/xdr/new?msisdn=\" + data.msisdn + \"&date=2015-04-01+10%3A17%3A14\").then(function() {\n          // Create Invoices\n          jQuery.getJSON(\"http://bender.\" + env.host + \".hh.blau.de/bender/billy/invoice_pdfs/new?debtor_id=\" + data.debtor_id + \"&msisdn_id=\" + data.msisdn + \"&months_and_amounts=%5B%7Bmonth%3A+%272015-03%27%2C+amount%3A+19.90%7D%2C+%7Bmonth%3A+%272015-02%27%2C+amount%3A+22.58%7D%2C+%7Bmonth%3A+%272015-01%27%2C+amount%3A+30.55%7D%5D\").then(function() {\n            resolve(data);\n          });\n        });\n      });\n    });\n  },\n  \"fields\": [{\n    \"import\": \"Konto Login (SHARED)\"\n  }]\n}, {\n  \"url\": /\\/konto\\/a(n|b)melden/,\n  \"name\": \"Anmelden (BLAU_UNION + Deaktiviert)\",\n  \"before\": function(resolve, context) {\n    Libs.env(context).then(function(env) {\n      jQuery.getJSON(\"http://bender.\" + env.host + \".hh.blau.de/bender/smiley/customer/new?mandant=BlauDe&base_tariff=BLAU_UNION&tariff_change_new_base_tariff=&tariff_change_status=&payment_type=CreditCard&with_sepa_data=true&topup_type=None&shipped_simcard=true&live_amount=100.00&tariff_option=BASETARIFF_UPGRADE_1GB&tariff_option_status=Provided&hardware_upgrade=&salespartner_id=&activation_date=2010-11-01+11%3A34%3A23&first_call=2010-11-01+11%3A34%3A23&distribution_type=Online&name=&order_date=2010-11-01+11%3A34%3A23&email=&contract_sign_stamp=2010-10-13+12%3A00%3A00&contract_start_date=2010-10-13+12%3A00%3A00&customer_consents_md_ids=41601%2C41602%2C41606%2C41607%2C41608%2C41609&deactivation_time=2015-04-22+10%3A40%3A34\").done(resolve);\n    });\n  },\n  \"fields\": [{\n    \"import\": \"Konto Login (SHARED)\"\n  }]\n}, {\n  \"url\": /\\/konto\\/a(n|b)melden/,\n  \"name\": \"Anmelden (BLAU_UNION + Vorkasse)\",\n  \"before\": function(resolve, context) {\n    Libs.env(context).then(function(env) {\n      jQuery.getJSON(\"http://bender.\" + env.host + \".hh.blau.de/bender/smiley/customer/new?mandant=\" + env.mandant + \"&base_tariff=BLAU_UNION&tariff_change_new_base_tariff=&tariff_change_status=&payment_type=Advance&with_sepa_data=true&topup_type=None&amount=30.00&tariff_option=&tariff_option_status=Provided&hardware_upgrade=&salespartner_id=&activation_date=2010-11-01+11%3A34%3A23&first_call=2010-11-01+11%3A34%3A23&distribution_type=Online&name=&order_date=2010-11-01+11%3A34%3A23&email=&contract_sign_stamp=2010-10-13+12%3A00%3A00&contract_start_date=2010-10-13+12%3A00%3A00&customer_consents_md_ids=41601%2C41602%2C41606%2C41607%2C41608%2C41609&deactivation_time=&date_of_birth=1986-12-22+00%3A00%3A00\").done(resolve);\n    });\n  },\n  \"fields\": [{\n    \"import\": \"Konto Login (SHARED)\"\n  }]\n}, {\n  \"url\": /\\/konto\\/a(n|b)melden/,\n  \"name\": \"Anmelden (BLAU_CLASSIC)\",\n  \"before\": function(resolve, context) {\n    Libs.env(context).then(function(env) {\n      jQuery.getJSON(\"http://bender.\" + env.host + \".hh.blau.de/bender/smiley/customer/new?mandant=\" + env.mandant + \"&base_tariff=BLAU_CLASSIC&tariff_change_new_base_tariff=&tariff_change_status=&payment_type=DirectDebit&with_sepa_data=true&topup_type=Watermark&amount=15.00&tariff_option=&tariff_option_status=Provided&tariff_options=&hardware_upgrade=&salespartner_id=&activation_date=2010-11-01+11%3A34%3A23&first_call=2010-11-01+11%3A34%3A23&distribution_type=Online&name=&order_date=2010-11-01+11%3A34%3A23&email=&contract_sign_stamp=2010-10-13+12%3A00%3A00&contract_start_date=2010-10-13+12%3A00%3A00&customer_consents_md_ids=41601%2C41602%2C41606%2C41607%2C41608%2C41609&deactivation_time=&date_of_birth=1986-12-22+00%3A00%3A00&evn_setting=Full\").done(resolve);\n    });\n  },\n  \"fields\": [{\n    \"import\": \"Konto Login (SHARED)\"\n  }]\n}, {\n  \"url\": /\\/konto\\/a(n|b)melden/,\n  \"name\": \"Anmelden (BLAU_DE_POSTPAID)\",\n  \"before\": function(resolve, context) {\n    Libs.env(context).then(function(env) {\n      jQuery.getJSON(\"http://bender.\" + env.host + \".hh.blau.de/bender/smiley/customer/new?mandant=BlauDePostpaid&base_tariff=BLAU_POSTPAID_UNION&payment_type=DirectDebit&with_sepa_data=true&topup_type=Watermark&amount=15.00&live_amount=30&activation_date=2010-11-01+11%3A34%3A23&first_call=2010-11-01+11%3A34%3A23&distribution_type=Online&order_date=2010-11-01+11%3A34%3A23&customer_consents_md_ids=41601%2C41602%2C41606%2C41607%2C41608%2C41609&date_of_birth=1986-12-22+00%3A00%3A00&evn_setting=Full\").done(resolve);\n    });\n  },\n  \"fields\": [{\n    \"import\": \"Konto Login (SHARED)\"\n  }]\n}, {\n  \"url\": /\\/konto\\/a(n|b)melden/,\n  \"name\": \"Anmelden (BLAU_UNION + Lastschrift)\",\n  \"before\": function(resolve, context) {\n    Libs.env(context).then(function(env) {\n      jQuery.getJSON(\"http://bender.\" + env.host + \".hh.blau.de/bender/smiley/customer/new?mandant=\" + env.mandant + \"&base_tariff=BLAU_UNION&tariff_change_new_base_tariff=&tariff_change_status=&payment_type=DirectDebit&with_sepa_data=true&topup_type=Watermark&amount=&tariff_option_status=&hardware_upgrade=&salespartner_id=&activation_date=2010-11-01+11%3A34%3A23&first_call=2010-11-01+11%3A34%3A23&distribution_type=Online&name=&order_date=2010-11-01+11%3A34%3A23&email=&contract_sign_stamp=2010-10-13+12%3A00%3A00&contract_start_date=2010-10-13+12%3A00%3A00&customer_consents_md_ids=41601%2C41602%2C41606%2C41607%2C41608%2C41609&deactivation_time=&date_of_birth=1986-12-22+00%3A00%3A00\").done(resolve);\n    });\n  },\n  \"fields\": [{\n    \"import\": \"Konto Login (SHARED)\"\n  }]\n}, {\n  \"content\": /self_care_user_remember_login_via_box/,\n  \"name\": \"Anmelden via Loginbox (BLAU_UNION + Lastschrift)\",\n  \"before\": function(resolve, context) {\n    Libs.env(context).then(function(env) {\n      jQuery.getJSON(\"http://bender.\" + env.host + \".hh.blau.de/bender/smiley/customer/new?mandant=\" + env.mandant + \"&base_tariff=BLAU_UNION&tariff_change_new_base_tariff=&tariff_change_status=&payment_type=DirectDebit&with_sepa_data=true&topup_type=Watermark&amount=&tariff_option_status=&hardware_upgrade=&salespartner_id=&activation_date=2010-11-01+11%3A34%3A23&first_call=2010-11-01+11%3A34%3A23&distribution_type=Online&name=&order_date=2010-11-01+11%3A34%3A23&email=&contract_sign_stamp=2010-10-13+12%3A00%3A00&contract_start_date=2010-10-13+12%3A00%3A00&customer_consents_md_ids=41601%2C41602%2C41606%2C41607%2C41608%2C41609&deactivation_time=&date_of_birth=1986-12-22+00%3A00%3A00\").done(resolve);\n    });\n  },\n  \"fields\": [{\n    \"selector\": \"#self_care_user_number\",\n    \"value\": function($e, data) {\n      return data.username;\n    }\n  }, {\n    \"selector\": \"#self_care_user_password\",\n    \"value\": function($e, data) {\n      return data.password;\n    }\n  }, {\n    \"selector\": \"#self_care_user_remember_login_via_box\",\n    \"value\": Libs.h.click\n  }, {\n    \"selector\": \"#new_self_care_user input[type=submit]\",\n    \"value\": Libs.h.click\n  }]\n}\n];",
        "tabId": 3
      },
      {
        "code": "var rules = [{\n  \"content\": /Jetzt einloggen und Guthaben aufladen!/,\n  \"name\": \"Mobile - Login - DirectDebit\",\n  \"before\": function(resolve, context) {\n    Libs.env(context).then(function(env) {\n      jQuery.getJSON('http://bender.' + env.host + '.hh.blau.de/bender/smiley/customer/new?mandant=BlauDe&base_tariff=BLAU_UNION&tariff_change_new_base_tariff=&tariff_change_status=&payment_type=DirectDebit&with_sepa_data=true&topup_type=None&shipped_simcard=true&amount=100.00&tariff_option=&tariff_option_status=Provided&hardware_upgrade=&salespartner_id=&activation_date=2010-11-01+11%3A34%3A23&first_call=2010-11-01+11%3A34%3A23&distribution_type=Online&name=&order_date=2010-11-01+11%3A34%3A23&email=&contract_sign_stamp=2010-10-13+12%3A00%3A00&contract_start_date=2010-10-13+12%3A00%3A00&customer_consents_md_ids=41601%2C41602%2C41606%2C41607%2C41608%2C41609').done(resolve);\n    });\n  },\n  \"fields\": [{\n    \"selector\": \"input[name='user[password]']\",\n    \"value\": \"xxxxxx\"\n  }, {\n    \"selector\": \"input[name='user[number]']\",\n    \"value\": function(_, data) {\n      return data.username;\n    }\n  }, {\n    \"selector\": \"#user_remember_login\",\n    \"value\": true\n  }, {\n    \"selector\": \"button.sec\",\n    \"value\": function(e) {\n      e.click();\n    }\n  }]\n}, {\n  \"content\": /class=\"order show customer\"/,\n  \"name\": \"Mobile - Bestellen - Kundendaten\",\n  \"fields\": [{\n    \"selector\": \"input[name='customer[first_name]']\",\n    \"value\": \"Vorname\"\n  }, {\n    \"selector\": \"input[name='customer[last_name]']\",\n    \"value\": \"Nachname\"\n  }, {\n    \"selector\": \"input[name='customer[date_of_birth]']\",\n    \"value\": \"01.01.1976\"\n  }, {\n    \"selector\": \"input[name='customer[address][street]']\",\n    \"value\": \"Neuer Steinweg\"\n  }, {\n    \"selector\": \"input[name='customer[address][house_number]']\",\n    \"value\": \"28\"\n  }, {\n    \"selector\": \"input[name='customer[address][addendum]']\",\n    \"value\": \"\"\n  }, {\n    \"selector\": \"input[name='customer[address][city]']\",\n    \"value\": \"Hamburg\"\n  }, {\n    \"selector\": \"input[name='customer[accepted_dne]']\",\n    \"value\": true\n  }, {\n    \"selector\": \"input[name='customer[email]']\",\n    \"value\": \"dev_mail@blau.de\"\n  }, {\n    \"selector\": \"input[name='customer[address][zip]']\",\n    \"value\": \"20459\"\n  }, {\n    \"selector\": \"select[name='customer[salutation]']\",\n    \"value\": \"Mr\"\n  }, {\n    \"selector\": \"select[name='customer[title]']\",\n    \"value\": \"Dr\"\n  }, {\n    \"selector\": \"select[name='customer[evn]']\",\n    \"value\": \"short\"\n  }]\n}, {\n  \"content\": /Bitte geben Sie dazu Ihre Lastschrift-Daten ein/,\n  \"name\": \"Mobile - Bestellen - Zahlungsdaten\",\n  \"fields\": [{\n    \"selector\": \"input[name='account_name']\",\n    \"value\": \"Vorname Nachname\"\n  }, {\n    \"selector\": \"input[name='payment[account_number]']\",\n    \"value\": \"DE21301204000000015228\"\n  }, {\n    \"selector\": \"input[name='payment[bank_code]']\",\n    \"value\": \"automatisch\"\n  }, {\n    \"selector\": \"input[name='bank_name']\",\n    \"value\": \"automatisch\"\n  }, {\n    \"selector\": \"input[name='payment[debit_allowed]']\",\n    \"value\": true\n  }]\n}\n];",
        "tabId": 4
      },
      {
        "code": "var libs = [{\n  export: \"env\",\n  lib: function(context) {\n    // Defaults\n    var env = {\n      mandant: \"BlauDe\",\n      host: \"team5\"\n    };\n    // Mapping from site name to mandant for bender\n    var siteToMandant = {\n      \"blaude3\": \"BlauDe\",\n      \"nettokom\": \"Netto\",\n      \"norma\": \"Norma\"\n    };\n    // Extract product (eg. \"blaude3\")\n    var matches = context.url.host.match(/^([\\\\w\\\\d]+)\\\\./);\n    return new Promise(function(resolveFinder) {\n      context.findHtml(\"meta[name=teamserver]\").then(function(html) {\n        var match = html.match(/content=[\"']([\\s\\S]*?)[\"']/);\n        env.host = match[1];\n        if (matches) {\n          env.mandant = siteToMandant[matches[1]];\n        }\n        resolveFinder(env);\n      });\n    });\n  }\n}\n];",
        "tabId": 5
      },
      {
        "code": "var sharedRules = [{\n  name: \"Konto Login (SHARED)\",\n  url: \"NEVER MATCH\",\n  \"fields\": [{\n    \"selector\": \"#self_care_user_number\",\n    \"value\": function(_, $data) {\n      return $data.username;\n    }\n  }, {\n    \"selector\": \"#self_care_user_password\",\n    \"value\": function(_, $data) {\n      return $data.password;\n    }\n  }, {\n    \"selector\": \"#self_care_user_remember_login\",\n    \"value\": true\n  }, {\n    \"selector\": \"button.sec.with-angle-after\",\n    \"value\": function(e) {\n      e.click();\n    }\n  }]\n}\n];",
        "tabId": 6
      },
      {
        "code": "var rules = [{\n  \"url\": /\\/sessions/,\n  \"name\": \"CSC - Login\",\n  \"before\": function(resolve, context) {\n    var cscUsers = {\n      1: 'test-agent',\n      2: 'test-supervisor',\n      3: 'test-bo-supervisor'\n    };\n    var formattedUserSelection = $.map(cscUsers, function(value, key) {\n      return (key + \": \" + value);\n    }).join('\\n\\t');\n    var username = prompt(\"Gib die Benutzernummer ein: \\n\\t\" + formattedUserSelection);\n    resolve({cscUsername: cscUsers[username]});\n  },\n  \"fields\": [{\n    \"selector\": \"input[name='user[username]']\",\n    \"value\": function(e, $data) {\n      return $data.cscUsername;\n    }\n  }, {\n    \"selector\": \"input[name='user[password]']\",\n    \"value\": \"Blau123\"\n  }, {\n    \"selector\": \"input[name='commit']\",\n    \"value\": function(e) {\n      e.click();\n    }\n  }]\n}, {\n  \"content\": /Offene Kontakte/,\n  \"name\": \"Dashboard - CSC\",\n  \"before\": function(resolve, context) {\n    Libs.env(context).then(function(env) {\n      var result = {};\n      jQuery.get(\"http://fry.\" + env.host + \".hh.blau.de/?domain=smiley\")\n      .fail(function() {\n        resolve(Libs.halt('<center style=\"font-size=55px;color: #fff; padding-bottom: 30px\">Fry gibt 404-Fehler zurück !!</center><img alt=\"error!\" src=\"http://www.hd-gbpics.de/gbbilder/lustige-gifs/lustige-gifs014.gif\"/>'));\n      }).done(function(result) {\n        resolve({\n          html: result,\n          host: env.host\n        });\n      });\n    });\n  },\n  \"fields\": [{\n    \"selector\": \"#new_contact\",\n    \"value\": function(e, $data) {\n      var benderSmileyHtml = $($data.html).find(\"form[action='http://bender.\" + $data.host + \".hh.blau.de/bender/smiley/customer/new']\");\n      if(!benderSmileyHtml){\n        alert(\"Das Formular '/smiley/customer/new new' wurde nicht gefunden!!!\");\n        return false;\n      }\n      var newCustomerSection = benderSmileyHtml.closest('section');\n      var html = jQuery.parseHTML('\\\n        <style>\\\n        .modal {\\\n          width: 700px;\\\n        }\\\n        .modal label {\\\n            width: 50%;\\\n            margin-top: 15px\\\n          }\\\n          .modal select {\\\n            width: 45%\\\n          }\\\n          .modal input[type=checkbox] {\\\n            width: 10%;\\\n          }\\\n          .modal input {\\\n            width: 43%;\\\n          }\\\n          .modal fieldset small {\\\n            font-size: 11px;\\\n            display: table-cell;\\\n          }\\\n          .modal.fade.in {\\\n            top: 15%;\\\n            left: 32%;\\\n          }\\\n          .modal .modal-body {\\\n            max-height: 800px\\\n          }\\\n          span {\\\n            padding: 0 0 0 1px\\\n          }\\\n        </style>\\\n        <div class=\"modal fade in\" id=\"activate_direct_debit\" aria-hidden=\"true\" style=\"display: block;\">\\\n              <div class=\"modal-header\">\\\n                <button type=\"button\" class=\"close\">x</button>\\\n                <h3>/smiley/customer/new</h3>\\\n              </div>\\\n              <div class=\"modal-body\">' + newCustomerSection.html() + '</div></div>');\n      e.append(html);\n    }\n  }, {\n    \"selector\": \".close\",\n    \"value\": function(e) {\n      e.on('click', function() {\n        $(this).closest('.modal').remove();\n      });\n    }\n  }, {\n    \"selector\": \"#activate_direct_debit form\",\n    \"value\": function(e) {\n      e.on('submit', function(event) {\n        event.preventDefault();\n        $('#contact_msisdn').css(\"background-color\", '#e3e3e3').attr('placeholder', 'bitte warten...');\n        $.ajax({ // create an AJAX call...\n          data: $(this).serialize(), // get the form data\n          type: $(this).attr('method'), // GET or POST\n          url: $(this).attr('action'), // the file to call\n          error: function(data, textStatus, jqXHR) {\n            $('#contact_msisdn').css(\"background-color\", '').attr('placeholder', 'Fehler beim Erstellen von Customer aufgetreten');\n            alert(\"Ist Bender erreichtbar?\");\n          },\n          success: function(response) { // on success..\n            $('#contact_msisdn').val(response.msisdn).css(\"background-color\", '#E0FFFF'); // set value of #contact_msisdn\n          }\n        });\n        //return true;\n      });\n    }\n  }]\n}\n];",
        "tabId": 7
      },
      {
        "code": "var rules = [{\n  \"content\": /Händler Login/,\n  \"name\": \"Händler Login - BlauDe\",\n  \"before\": function(resolve, context) {\n    Libs.env(context).then(function(env) {\n      jQuery.getJSON(\"http://bender.\" + env.host + \".hh.blau.de/bender/smiley/partner/new?mandant=BlauDe&create_simcard=true&article_id=1019000\").done(function(data) {\n        context.storage.set(\"partner\", data);\n        resolve(data);  \n      });\n    });\n  },\n  \"fields\": [{\n    \"selector\": \"#credential_sales_partner_username\",\n    \"value\": function($e, data) {\n      return data.username;\n    }\n  }, {\n    \"selector\": \"#credential_sales_partner_password\",\n    \"value\": function($e, data) {\n      return data.password;\n    }\n  }, {\n    \"selector\": \".btn-blau.login-button\",\n    \"value\": Libs.h.click\n  }]\n}, {\n  \"content\": /Ich habe anhand vom Personalauswe/,\n  \"name\": \"Händler Freischalten 1\",\n  \"fields\": [{\n    \"selector\": \"input[name='private[first_name]']\",\n    \"value\": \"Karl\"\n  }, {\n    \"selector\": \"input[name='private[last_name]']\",\n    \"value\": \"Schmidt\"\n  }, {\n    \"selector\": \"input[name='private[date_of_birth]']\",\n    \"value\": \"01.01.1970\"\n  }, {\n    \"selector\": \"input[name='private[billing_address_attributes][street]']\",\n    \"value\": \"Ordingweg\"\n  }, {\n    \"selector\": \"input[name='private[billing_address_attributes][house_number]']\",\n    \"value\": \"1001\"\n  }, {\n    \"selector\": \"input[name='private[billing_address_attributes][addendum]']\",\n    \"value\": \"\"\n  }, {\n    \"selector\": \"input[name='private[billing_address_attributes][zip]']\",\n    \"value\": \"22303\"\n  }, {\n    \"selector\": \"input[name='private[billing_address_attributes][city]']\",\n    \"value\": \"Grimmelshausen\"\n  }, {\n    \"selector\": \"input[name='private[identification][identity_number]']\",\n    \"value\": \"T220001293\"\n  }, {\n    \"selector\": \"input[name='private[email]']\",\n    \"value\": \"dev_mail@blau.de\"\n  }, {\n    \"selector\": \"input[name='private[payment][account_number]']\",\n    \"value\": \"DE68300700100250800000\"\n  }, {\n    \"selector\": \"input[name='private[payment][bank_code]']\",\n    \"value\": \"Wird automatisch ausgefüllt\"\n  }, {\n    \"selector\": \"input[name='private[identification][checked_identity_card]']\",\n    \"value\": true\n  }, {\n    \"selector\": \"input[name='private[payment][debit_allowed]']\",\n    \"value\": true\n  }, {\n    \"selector\": \"input[name='private[accepted_dne]']\",\n    \"value\": true\n  }, {\n    \"selector\": \"input[name='private[payment][payment_type]']\",\n    \"value\": \"Direct_Debit\"\n  }, {\n    \"selector\": \"select[name='private[salutation]']\",\n    \"value\": \"Mr\"\n  }, {\n    \"selector\": \"select[name='private[title]']\",\n    \"value\": \"\"\n  }, {\n    \"selector\": \"select[name='private[identification][nationality]']\",\n    \"value\": \"DE\"\n  }, {\n    \"selector\": \"select[name='private[evn]']\",\n    \"value\": \"full\"\n  }]\n}, {\n  \"content\": /wählen Sie hier das gewünschte Startpaket aus/,\n  \"name\": \"Händler Freischalten 2 (Allnet + Upgrades)\",\n  \"fields\": [{\n    \"selector\": \"select[name='tariff[name]']\",\n    \"value\": \"allnetflat\"\n  }, {\n    \"selector\": \"#tariff_upgrades_sms_flat\",\n    \"value\": true\n  }, {\n    \"selector\": \"#tariff_upgrades_internet_flat\",\n    \"value\": true\n  }]\n}, {\n  \"url\": /freischalten\\/login/,\n  \"name\": \"Händler Freischalten 3 (BlauDe)\",\n  \"fields\": [{\n    \"selector\": \"#merchant_cashcarry_login_fullnumber\",\n    \"value\": function($e, data) {\n      return context.storage.get(\"partner\").fullnumber;\n    }\n  }, {\n    \"selector\": \"#merchant_cashcarry_login_credential\",\n    \"value\": function($e, data) {\n      return context.storage.get(\"partner\").sim_number;\n    }\n  }, {\n    \"selector\": \"#merchant_cashcarry_login_with_mnp_false\",\n    \"value\": Libs.h.click\n  }\n  ]\n}\n];",
        "tabId": 8
      },
      {
        "code": "var rules = [{\n  \"url\": /esim/,\n  \"name\": \"ESIM\",\n  \"before\": function(resolve, context) {\n    var options = [\"1. ESIM (9cent)\", \"2. MassESIM\"];\n    var answer = prompt(options.join(\"\\n\"));\n    Libs.env(context).then(function(env) {\n      if (answer == 1) {\n        jQuery.getJSON(\"http://bender.\" + env.host + \".hh.blau.de/bender/smiley/msisdn/new?mandant=\" + env.mandant).done(resolve);\n      }\n      if (answer == 2) {\n        var esim = (\"esim\" + Math.random()).replace(\".\",\"\");\n        jQuery.getJSON(\"http://bender.\" + env.host + \".hh.blau.de/bender/moe/voucher/massesim/new?salesPartnerId=1181&dateStart=2015-05-11+09%3A02%3A23&dateEnd=2015-10-31+09%3A02%3A28&code=\" + esim + \"&maxCount=2&article=BlauOnlineTripleSim+%28id%3D1034000%29\").done(resolve);\n      }\n    });\n  },\n  \"fields\": [{\n    \"selector\": \"input[name='order_esim[code]']\",\n    \"value\": function($e, data) {\n      return data.code;\n    }\n  }, {\n    \"selector\": \"input[type=submit]\",\n    \"value\": Libs.h.click\n  }]\n}\n];",
        "tabId": 9
      }
    ]
  }
}
</textarea>

<div class="alert alert-warning" role="alert">
  <strong>This is a live tutorial.</strong>
  If you are already using Form-O-Fill please export your rules and workflows <strong>before</strong> starting this tour.
</div>

<div class="panel panel-default">
  <div class="panel-heading">Assuming this basic &lt;form&gt;:</div>
  <div class="panel-body">
    <form action="#">
      <label class="input-group">
        An input element:
        <input class="form-control" type="text" name="text" value="input field content" />
      </label>
      <label class="input-group">
        A pressed radio button:
        <input type="radio" name="radio" value="A pressed radio button" checked />
      </label>
      <label class="input-group">
        A Checkbox:
        <input type="checkbox" name="checkbox-value" value="checkbox" checked />
      </label>
      <label class="input-group">
        Select (multiple)
        <select multiple name="select-multi">
          <option>Option 1</option>
          <option selected>Option 2</option>
          <option selected>Option 3</option>
        </select>
      </label>
      <button type="submit" class="btn btn-default">Submit</button>
    </form>
  </div>
</div>

<button type="button" class="btn btn-lg btn-success tut-tour-start">Start Tour 1 : Extracting rules</button>

<div class="tuts">
  <div class="step" data-element=".alert-warning" data-import-rules="#rules1">
    <strong>Hello!</strong>
    <p>
      Before starting: Have you read this important message?
    </p>
  </div>

  <div class="step" data-element="form">
    This will be the form we will work with. It contains the usual field types in this case a textfield , a radiobutton, a checkbox and a select field.
  </div>

  <div class="step" data-element="form">
    It has been pre-filled for this tutorial.
  </div>

  <div class="step" data-element=".top-right" data-position="bottom-right-aligned" data-overlay="false">
    <p>
      Lets start:
    </p>
    <p>
      Somewhere up here should be the Form-O-Fill action icon.<br />
      It looks like this:
      <img src="/img/tutorial/button-when-not-matching.png" />
      <strong>Don't click it just yet.</strong>
    </p>
  </div>

  <div class="step" data-element=".top-right" data-position="bottom-right-aligned" data-buttons="false" data-overlay="false">
    <p>
      When you click it you will see the browser action popup.
    </p>
    <img src="/img/tutorial/form-extraction-popup.png" />
    <p>
      To extract form data from the page, click the "Extract" link.
    </p>
    <p>
      <strong>Do that now!</strong>
    </p>
  </div>

  <div class="step" data-element=".form-o-fill-overlay-form" data-trigger="+form-o-fill-overlay-form" data-overlay="false" data-buttons="false">
    <p>
      This red-ish element is used by Form-O-Fill to mark extractable <code>form</code> elements.
    </p>
    <p>
      Every detected form element will be extracted if you click on the red area.
    </p>
    <p>
      <strong>Do that now!</strong>
    </p>
  </div>
  
  <div class="step" data-tutorial="1" data-element=".top-right" data-trigger="-form-o-fill-overlay-form" data-position="bottom-right-aligned" data-overlay="false">
    <p>
      Form-O-Fill has now extracted the <code>form</code> fields and is ready to work with them:
    </p>
    <img src="/img/tutorial/form-extraction-notification.png" />
    <p>
      You can now click the notification or open the browser action popup again and click on "Options".
    </p>
    <img src="/img/tutorial/form-extraction-popup-2.png" />
    <p>
      <strong>Do that now!</strong> This will open the options page in a new tab.
    </p>
  </div>

</div>
